



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="zh">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>1.4.命名空间与作用域 - Python笔记</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Python笔记" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Python笔记
            </span>
            <span class="md-header-nav__topic">
              
                1.4.命名空间与作用域
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/siwing/siwing.github.io/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Python笔记" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Python笔记
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/siwing/siwing.github.io/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    
    <label class="md-nav__link" for="nav-1">
      计算机基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        计算机基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="1.1.计算机与程序结构.html" title="1.1.计算机与程序结构" class="md-nav__link">
      1.1.计算机与程序结构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="1.2.基本概念.html" title="1.2.基本概念" class="md-nav__link">
      1.2.基本概念
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="1.3.编译型语言和解释型语言的优缺点对比.html" title="1.3.编译型语言和解释型语言的优缺点对比" class="md-nav__link">
      1.3.编译型语言和解释型语言的优缺点对比
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        1.4.命名空间与作用域
      </label>
    
    <a href="1.4.命名空间与作用域.html" title="1.4.命名空间与作用域" class="md-nav__link md-nav__link--active">
      1.4.命名空间与作用域
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="命名空间" class="md-nav__link">
    命名空间
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace" title="Namespace的种类" class="md-nav__link">
    Namespace的种类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="命名空间的生命周期" class="md-nav__link">
    命名空间的生命周期
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="命名空间的查看" class="md-nav__link">
    命名空间的查看
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="总结" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="作用域" class="md-nav__link">
    作用域
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="作用域与命名空间的关系" class="md-nav__link">
    作用域与命名空间的关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="名字搜索顺序" class="md-nav__link">
    名字搜索顺序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="引用作用域需要注意的问题" class="md-nav__link">
    引用作用域需要注意的问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-nonlocal" title="global和 nonlocal的作用" class="md-nav__link">
    global和 nonlocal的作用
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" title="借壳" class="md-nav__link">
    借壳
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-nonlocal_1" title="global 和 nonlocal 语句对标识符创建的不同影响" class="md-nav__link">
    global 和 nonlocal 语句对标识符创建的不同影响
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="类的局部命名空间" class="md-nav__link">
    类的局部命名空间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="总结" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="1.5.字符编码.html" title="1.5.字符编码" class="md-nav__link">
      1.5.字符编码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Python 基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Python 基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.1.python基本语法.html" title="2.1.python基本语法" class="md-nav__link">
      2.1.python基本语法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.2.语句.html" title="2.2.语句" class="md-nav__link">
      2.2.语句
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.3.List.html" title="2.3.List" class="md-nav__link">
      2.3.List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.4.String.html" title="2.4.String" class="md-nav__link">
      2.4.String
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.5.Tuple.html" title="2.5.Tuple" class="md-nav__link">
      2.5.Tuple
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.6.Dict.html" title="2.6.Dict" class="md-nav__link">
      2.6.Dict
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.7.推导式.html" title="2.7.推导式" class="md-nav__link">
      2.7.推导式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.8.赋值、immutable、深拷贝.html" title="2.8.赋值、immutable、深拷贝" class="md-nav__link">
      2.8.赋值、immutable、深拷贝
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/2.9.函数.html" title="2.9.函数" class="md-nav__link">
      2.9.函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/3.1.异常.html" title="3.1.异常" class="md-nav__link">
      3.1.异常
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/3.2.命名空间和作用域.html" title="3.2.命名空间和作用域" class="md-nav__link">
      3.2.命名空间和作用域
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/3.3.闭包.html" title="3.3.闭包" class="md-nav__link">
      3.3.闭包
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/3.4.装饰器.html" title="3.4.装饰器" class="md-nav__link">
      3.4.装饰器
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/4.1.类.html" title="4.1.类" class="md-nav__link">
      4.1.类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python基础/4.2.模块.html" title="4.2.模块" class="md-nav__link">
      4.2.模块
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      开发环境管理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        开发环境管理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../开发环境管理/5.1.conda笔记.html" title="5.1.conda笔记" class="md-nav__link">
      5.1.conda笔记
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../开发环境管理/5.3.pip对比conda.html" title="5.3.pip对比conda" class="md-nav__link">
      5.3.pip对比conda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../开发环境管理/5.4.anaconda.html" title="5.4.anaconda" class="md-nav__link">
      5.4.anaconda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../开发环境管理/5.5.jupyter使用笔记.html" title="5.5.jupyter使用笔记" class="md-nav__link">
      5.5.jupyter使用笔记
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Numpy笔记
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Numpy笔记
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.1.创建数组.html" title="6.1.创建数组" class="md-nav__link">
      6.1.创建数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.2.索引.html" title="6.2.索引" class="md-nav__link">
      6.2.索引
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.3.内存布局.html" title="6.3.内存布局" class="md-nav__link">
      6.3.内存布局
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.4.广播.html" title="6.4.广播" class="md-nav__link">
      6.4.广播
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.5.常量.html" title="6.5.常量" class="md-nav__link">
      6.5.常量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.6.打印数组.html" title="6.6.打印数组" class="md-nav__link">
      6.6.打印数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.7.添加和删除.html" title="6.7.添加和删除" class="md-nav__link">
      6.7.添加和删除
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.8.形状操纵.html" title="6.8.形状操纵" class="md-nav__link">
      6.8.形状操纵
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.9.ufunc函数.html" title="6.9.ufunc函数" class="md-nav__link">
      6.9.ufunc函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.10.函数库.html" title="6.10.函数库" class="md-nav__link">
      6.10.函数库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../numpy笔记/6.12.结构化数组.html" title="6.12.结构化数组" class="md-nav__link">
      6.12.结构化数组
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      pandas笔记
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        pandas笔记
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pandas笔记/7.1.Series.html" title="7.1.Series" class="md-nav__link">
      7.1.Series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pandas笔记/7.2.DataFrame.html" title="7.2.DataFrame" class="md-nav__link">
      7.2.DataFrame
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="命名空间" class="md-nav__link">
    命名空间
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#namespace" title="Namespace的种类" class="md-nav__link">
    Namespace的种类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="命名空间的生命周期" class="md-nav__link">
    命名空间的生命周期
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="命名空间的查看" class="md-nav__link">
    命名空间的查看
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="总结" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="作用域" class="md-nav__link">
    作用域
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="作用域与命名空间的关系" class="md-nav__link">
    作用域与命名空间的关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="名字搜索顺序" class="md-nav__link">
    名字搜索顺序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="引用作用域需要注意的问题" class="md-nav__link">
    引用作用域需要注意的问题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-nonlocal" title="global和 nonlocal的作用" class="md-nav__link">
    global和 nonlocal的作用
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" title="借壳" class="md-nav__link">
    借壳
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-nonlocal_1" title="global 和 nonlocal 语句对标识符创建的不同影响" class="md-nav__link">
    global 和 nonlocal 语句对标识符创建的不同影响
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="类的局部命名空间" class="md-nav__link">
    类的局部命名空间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="总结" class="md-nav__link">
    总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/siwing/siwing.github.io/edit/master/docs/计算机基础/1.4.命名空间与作用域.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>1.4.命名空间与作用域</h1>
                
                <h2 id="_1">命名空间</h2>
<p>==<strong>Namespace :</strong> A namespace is a mapping from names to objects. 命名空间，也称名字空间，是从名字（标识符）到对象的映射。==在<code>Python</code>中，命名空间由字典来实现的，即{key:value} ↔{名字:对象}。</p>
<p>命名空间的最重要的作用是避免名字冲突，各个命名空间是独立的，因此不同的命名空间可以重名。</p>
<h3 id="namespace">Namespace的种类</h3>
<p>常见的命名空间有：</p>
<p><strong>内置命名空间</strong>：存放着built-in Functions（内置函数）的名字、内置的异常的名字、内置常量，内置类型。</p>
<p><strong>全局命名空间</strong>：每个模块（<code>.py</code>文件）拥有它自己的命名空间，包含了直接定义在模块中的名字，例如类、函数、导入的其它模块等等。</p>
<p><strong>局部命名空间</strong>：每个函数都有着自已的命名空间，它记录了函数的名字（函数的参数、局部定义的名字）</p>
<blockquote>
<p>local namespace：局部命名空间
global namespace：全局命名空间
Built-in  namespace：内置命名空间</p>
</blockquote>
<p>另外：</p>
<ul>
<li>一个对象的属性集合，也构成了一个命名空间。但通常使用<code>objname.attrname</code>的间接方式访问属性，而不是直接访问，故不将其列入命名空间讨论。</li>
<li>类定义的命名空间，通常解释器进入类定义时，即执行到<code>class ClassName:</code>语句，会新建一个命名空间。(见官方对类定义的<a href="https://docs.python.org/3/tutorial/classes.html#class-definition-syntax">说明</a>)</li>
</ul>
<h3 id="_2">命名空间的生命周期</h3>
<blockquote>
<p>标识符产生地点决定标识符所处的命名空间。</p>
</blockquote>
<p>不同类型的命名空间有不同的生命周期：</p>
<ul>
<li>built-in：在<code>Python</code>解释器启动时创建，解释器退出时销毁</li>
<li>global：在模块定义被解释器读入时创建，通常也会一直保存到解释器退出 </li>
<li>local：这里要区分<code>function</code>以及<code>class</code>定义：</li>
<li>函数的局部命名空间：在函数调用时创建，函数返回或者由未捕获的异常时销毁</li>
<li>类定义的命名空间：在解释器读到类定义创建，类定义结束后销毁。（关于类定义的命名空间，在类定义结束后销毁，但其实类对象就是这个命名空间内容的包装，见官方对类定义的<a href="https://docs.python.org/3/tutorial/classes.html#class-definition-syntax">说明</a>）</li>
</ul>
<h3 id="_3">命名空间的查看</h3>
<ol>
<li>局部命名空间可以通过<code>locals()</code>来访问。</li>
<li>全局 （模块级别）命名空间可以通过<code>globals()</code>来访问。</li>
</ol>
<p><code>locals</code>实际返回的是一个局部名字空间的拷贝，所以修改<code>locals()</code>对象并不会影响局部名字空间。<code>globals</code>返回是全局名字空间，而不是其拷贝，所以修改<code>globals()</code>对象会影响全局名字。</p>
<div class="codehilite"><pre><span></span><span class="c1"># 修改局部命名空间无效</span>
<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">123</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;当前的局部作用域&quot;</span><span class="p">,</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">locals</span><span class="p">()[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6789</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;修改局部作用域后，并不影响x的值&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x =&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">当前的局部作用域</span>
<span class="err">{&#39;i&#39;: 10, &#39;x&#39;: 123}</span>
<span class="err">修改局部作用域后，并不影响x的值</span>
<span class="err">x = 123</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1"># 修改全局命名空间生效</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">456</span>
<span class="nb">globals</span><span class="p">()[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">789</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y =&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="err">y = 789</span>
</pre></div>


<h3 id="_4">总结</h3>
<ol>
<li>
<p>模块的名字空间不仅仅包含模块级的变量和常量，还包括所有在模块中定义的函数和类。除此以外，它还包括了任何被导入到模块中的东西。</p>
</li>
<li>
<p>内置命名也同样被包含在一个模块中，它被称作 built-in。</p>
</li>
<li>
<p>回想一下<code>from module import</code>和 <code>import module</code>之间的不同：</p>
</li>
</ol>
<p>使用<code>import module</code>，模块自身被导入，但是它保持着自已的名字空间，即<code>module.function</code> 。</p>
<p>使用 <code>from module import function</code>，实际上是从另一个模块中将指定的函数和属性导入当前名字空间，因此可以直接访问它们。使用 globals 函数，可以展现这一过程的变化。</p>
<h2 id="_5">作用域</h2>
<p><strong>scope :</strong> A scopeis a textual region of a Python program where a namespace is directly accessible. </p>
<p>作用域是<code>Python</code>的一块文本区域，这个区域中，命名空间可以被“直接引用”。</p>
<blockquote>
<p>直接引用：直接使用名字访问，如<code>name</code>，这种方式尝试在名字空间中搜索名字<code>name</code>。</p>
<p>间接引用：使用形如<code>objname.attrname</code>的方式，即属性引用，这种方式不会在命名空间中搜索名字<code>attrname</code>，而是搜索名字<code>objname</code>，再访问其属性。</p>
</blockquote>
<h3 id="_6">作用域与命名空间的关系</h3>
<p>现在，命名空间持有了名字。作用域是<code>Python</code>的一块文本区域，即一块代码区域，需要代码区域引用名字（访问变量），那么作用域与命名空间之间就有了联系。</p>
<p>顾名思义，名字作用域就是名字可以影响到的代码文本区域，命名空间的作用域就是这个命名空间可以影响到的代码文本区域。那么也存在这样一个代码文本区域，多个命名空间可以影响到它。 </p>
<p>作用域只是文本区域，其定义是静态的；而名字空间却是动态的，只有随着解释器的执行，命名空间才会产生。那么，在静态的作用域中访问动态命名空间中的名字，造成了作用域使用的动态性。</p>
<p>那么，可以这样认为：</p>
<blockquote>
<p>静态的作用域，是一个或多个命名空间按照一定规则叠加影响代码区域；运行时动态的作用域，是按照特定层次组合起来的命名空间。</p>
</blockquote>
<p>在一定程度上，可以认为<strong>动态的作用域就是命名空间</strong>。在后面的表述中，我会把动态的作用域与其对应命名空间等同起来。</p>
<p><strong>在Python中，scope是由namespace按特定的层级结构组合起来的。scope一定是namespace，但namespace不一定是scope.</strong></p>
<h3 id="_7">名字搜索顺序</h3>
<p>当一行代码需要使用名字<code>X</code>所对应的值，python会从当前层级的Namespace开始，并根据以下顺序，去查找<code>X</code>这个名字：</p>
<ol>
<li>local namespace：</li>
</ol>
<p>包含局部名字的最内层（innermost）作用域，如函数、方法、类的内部局部作用域。</p>
<ol>
<li>Enclosing</li>
</ol>
<p>根据嵌套层次从内到外搜索，包含非局部（nonlocal）非全局（nonglobal）名字的任意封闭函数的作用域。如两个嵌套的函数，内层函数的作用域是局部作用域，外层函数作用域就是内层函数的 Enclosing作用域。</p>
<ol>
<li>
<p>Global</p>
</li>
<li>
<p>Built-in</p>
</li>
<li>
<p>如果 Python 在这些namespace找不到<code>X</code>，它将放弃查找并引发一个 NameError 异常：<code>NameError: name 'aa' is not defined</code></p>
</li>
</ol>
<p>程序在运行时，local、global、built-in三个namespace一定存在，但Enclosing namespace不一定存在。</p>
<h3 id="_8">引用作用域需要注意的问题</h3>
<ol>
<li><strong>不能在名字未定义前引用该名字</strong></li>
<li><strong><code>if</code>、<code>for</code>语句并不会引入新的作用域</strong></li>
<li><strong>外层作用域不能引用内层作用域的变量</strong></li>
</ol>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">try_to_define_name</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;函数中定义了名字i，并绑定了一个整数对象1&#39;&#39;&#39;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">try_to_define_name</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1">#引用名字i之前，调用了函数</span>
</pre></div>


<p>在引用名字<code>i</code>之前，明明调用了函数，定义了名字<code>i</code>，可是还是找不到这个名字：</p>
<div class="codehilite"><pre><span></span><span class="err">Traceback (most recent call last):</span>
<span class="err">  File &quot;scope_test.py&quot;, line 20, in &lt;module&gt;</span>
<span class="err">    print(i) #引用名字i之前，调用了函数</span>
<span class="c">NameError: name &#39;i&#39; is not defined</span>
</pre></div>


<p>虽然定义了名字<code>i</code>，但是定义在了函数的局部作用域对应的局部命名空间中，按照<code>LEGB</code>搜索规则，在全局作用域中自然访问不到局部作用域；再者，函数调用结束后，这个命名空间被销毁了。</p>
<p><mark>引用变量总是与作用域相关的，因此：在Python中一个名字只有在定义之后，才能在合适的作用域引用。</mark></p>
<p>一般来说，<code>B,G</code>两个作用域的引入是不能够通过代码操作的（参考命名空间的生命周期），能够通过语句引入的作用域只有<code>E,L</code>了。Python中引入新作用域的语句很有限，总的来说只有如下三种：</p>
<ul>
<li>通过定义函数引入<code>local</code>作用域或者<code>Enclosing</code>作用域；本质上，<code>lambda</code>和生成器表达式也是函数，会引入新作用域。</li>
<li>类定义引入<code>local</code>作用域；</li>
<li>列表推导式引入<code>local</code>作用域，传说在<code>python2</code>中列表推导式不引入新的作用域</li>
</ul>
<p><strong>import语句</strong>：</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">import_sys</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;import sys module&#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">sys</span>

<span class="n">import_sys</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="c1"># NameError: name &#39;sys&#39; is not defined</span>
</pre></div>


<p>这个算非正常程序员的写法了，在另一篇文章<a href="http://blog.csdn.net/sakurainluojia/article/details/72772533">《Python进阶 - 对象，名字以及绑定》</a>中介绍过，<code>import</code>语句在函数<code>import_sys</code>中将名字<code>sys</code>和对应模块绑定，那<code>sys</code>这个名字还是定义在局部作用域，跟上面的例子没有任务区别。</p>
<h2 id="global-nonlocal"><code>global</code>和 <code>nonlocal</code>的作用</h2>
<p>任何时候，python都可以直接读取全局变量，但是却不可以在内层作用域直接改写上层变量，来看一个典型的<a href="https://segmentfault.com/q/1010000004505977/a-1020000004506793">闭包</a>结构：</p>
<div class="codehilite"><pre><span></span><span class="c1">#e.py</span>
<span class="n">gv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">gv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">gv</span> <span class="c1">#UnboundLocalError:local variable &#39;gv&#39; referenced before assignment</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">inn_func</span><span class="p">():</span>
        <span class="n">lv</span> <span class="o">=</span> <span class="n">lv</span> <span class="o">+</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>  <span class="c1">#UnboundLocalError:local variable &#39;lv&#39; referenced before assignment</span>
        <span class="n">gv</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">gv</span>   
    <span class="k">return</span> <span class="n">inn_func</span>
</pre></div>


<p>实际<strong>调用</strong> <code>func()</code>函数后，上面两处对 <code>gv</code> 和 <code>lv</code> 进行赋值操作的地方都会发生 <code>UnboundLocalError</code>：<mark>因为 Python 在执行函数前，会首先生成各层命名空间和作用域</mark>，因此 Python 在执行赋值前会将<code>func</code> 内的 <code>'gv'</code> <code>'lv'</code> 写入局部命名空间和闭包命名空间，当 Python <strong>执行</strong>赋值时会在局部作用域、闭包作用域内发现局部命名空间和闭包命名空间内已经具有<code>'gv'</code> 和 <code>'lv'</code> 标识符，但这两个非全局标识符在该赋值语句执行之前并没有被赋值，也即没有对象与标识符关联，因此无法参与四则运算，从而引发错误。</p>
<p>这段程序本意只是想让具有对象的全局变量<code>gv</code> 和局部变量 <code>lv</code> 参与运算，为了避免类似的情况发生，<mark>Python 便引入了 <code>global</code>、<code>nonlocal</code> 语句来说明所修饰的 <code>gv</code>、<code>lv</code> 分别来自全局命名空间和局部命名空间</mark>，声明之后，就可以在 <code>func</code> 和 <code>inn_func</code> 内直接改写上层命名空间内 <code>gv</code> 和 <code>lv</code> 的值：</p>
<div class="codehilite"><pre><span></span><span class="c1">#f.py</span>
<span class="n">gv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">gv</span>
    <span class="n">gv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">gv</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lv</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">inn_func</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">lv</span>
        <span class="n">lv</span> <span class="o">=</span> <span class="n">lv</span> <span class="o">+</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lv</span><span class="p">))</span>
        <span class="n">gv</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">gv</span>
    <span class="k">return</span> <span class="n">inn_func</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="s1">&#39;is&#39;</span><span class="p">)</span>
<span class="o">#</span> <span class="mi">2608229974344</span>

<span class="n">a</span><span class="p">()</span>
<span class="o">#</span> <span class="mi">2608229974344</span>
<span class="o">#</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>

<span class="n">print</span><span class="p">(</span><span class="n">gv</span><span class="p">)</span>
<span class="o">#</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>
</pre></div>


<p>如上，全局变量 <code>gv</code> 值被函数改写了， <code>inn_func</code> 修改的也确实是父函数 <code>lv</code>的值 （依据 ID 判断）。</p>
<h3 id="_9">借壳</h3>
<p>那么是不是不使用 <code>global</code> 和 <code>nonlocal</code> 就不能达到上面的目的呢？来看看这段程序：</p>
<div class="codehilite"><pre><span></span><span class="c1">#g.py</span>
<span class="n">gv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">gv</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;gv&#39;</span><span class="p">)</span> <span class="c1"># 注意的是.insert只是对gv的元素进行修改，而不是修改gv整个对象,gv是list，元素可变</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lv</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">inn_func</span><span class="p">():</span>
        <span class="n">lv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="c1"># 注意的是.insert只是对lv的元素进行修改，而不是修改lv整个对象</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lv</span><span class="p">))</span>
        <span class="n">gv</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">gv</span>
    <span class="k">return</span> <span class="n">inn_func</span>
</pre></div>


<p>执行的结果：</p>
<div class="codehilite"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="s1">&#39;is&#39;</span><span class="p">)</span>
<span class="o">#</span> <span class="mi">2608110869168</span>

<span class="n">a</span><span class="p">()</span>
<span class="o">#</span> <span class="mi">2608110869168</span>
<span class="o">#</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>

<span class="n">print</span><span class="p">(</span><span class="n">gv</span><span class="p">)</span>
<span class="o">#</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>
</pre></div>


<p>可以发现，执行结果同上面完全一致，问题自然来了：“为什么不用 <code>global</code> <code>nonlocal</code> 也可以改写全局变量<code>gv</code>和父函数变量<code>lv</code>的值？</p>
<p>为了看清楚这个过程，我们将上面的<code>gv.insert(0, 'gv')</code> 和<code>lv.append(v)</code> 改写为 <code>gv[0:0] = ['gv']</code> 和<code>lv[:] = [v]</code>：</p>
<div class="codehilite"><pre><span></span><span class="c1">#h.py</span>
<span class="n">gv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">gv</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">]</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lv</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">inn_func</span><span class="p">():</span>
        <span class="n">lv</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">lv</span><span class="p">))</span>
        <span class="n">gv</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">gv</span>
    <span class="k">return</span> <span class="n">inn_func</span>
</pre></div>


<p>执行结果：</p>
<div class="codehilite"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="s1">&#39;is&#39;</span><span class="p">)</span>
<span class="o">#</span> <span class="mi">2608229959496</span>

<span class="n">a</span><span class="p">()</span>
<span class="o">#</span> <span class="mi">2608229959496</span> 
<span class="o">#</span> <span class="p">[</span><span class="s1">&#39;gv&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>
</pre></div>


<p>同 g.py 文件的执行结果完全一致，事实上两者之间的内在也是完全一样的。</p>
<p><mark>其实，我们其实改写的不是 <code>gv</code> 和 <code>lv</code> ,而是 <code>gv</code> 和 <code>lv</code> 的元素 <code>gv[0:0]</code> 和 <code>lv[:]</code> 。因此，不需要 <code>global</code> 和 <code>nonlocal</code>修饰就可以直接改写，<strong>这就是“借壳”，</strong>这是因为list是可变对象。</mark></p>
<p>在 <code>nonlocal</code> 尚未引入 Python 中，比如 Python 2.x 若要在子函数中改写父函数变量的值就得通过这种方法。当然借壳蕴藏着一个相对复杂的标识符创建的问题：比如子函数通过借壳修改父函数变量<code>lv</code>的值，那么子函数的标识符<code>lv</code>是怎么绑定到父函数变量<code>lv</code>的值 ID 的上的？</p>
<p>关于这个问题，这里有个问答就是讨论这个的：<a href="https://segmentfault.com/q/1010000004505977/a-1020000004506793">python的嵌套函数中局部作用域问题?</a></p>
<blockquote>
<p>这个问题在python函数传参的内容有讲清楚。</p>
</blockquote>
<h3 id="global-nonlocal_1">global 和 nonlocal 语句对标识符创建的不同影响</h3>
<p><strong>另外，需要注意的是：global 语句只是声明该标识符引用的变量来自于全局变量，但并不能直接在当前层创建该标识符；nonlocal 语句则会在子函数命名空间中创建与父函数变量同名的标识符：</strong></p>
<div class="codehilite"><pre><span></span><span class="c1">#j.py</span>
<span class="n">gv</span> <span class="o">=</span> <span class="s1">&#39;a global var&#39;</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">gv</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="s1">&#39;a local var&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">inn_func</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">lv</span>
        <span class="k">global</span> <span class="n">gv</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">inn_func</span>
</pre></div>


<p>执行结果：</p>
<div class="codehilite"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="nf">func</span><span class="p">()</span>
<span class="err">{</span><span class="s1">&#39;lv&#39;</span><span class="p">:</span> <span class="s1">&#39;a local var&#39;</span><span class="err">}</span>   <span class="c1">#运行 `func` 函数后，`global` 语句并未将 `gv` 变量引入局部命名空间</span>

<span class="nf">c</span><span class="p">()</span>
<span class="err">{</span><span class="s1">&#39;lv&#39;</span><span class="p">:</span> <span class="s1">&#39;a local var&#39;</span><span class="err">}</span>   <span class="c1">#运行闭包函数后，`nonlocal` 语句将父函数变量 `lv` 引入闭包命名空间</span>
</pre></div>


<p>之所以 <code>nonlocal</code> 语句与 <code>global</code> 语句的处置不同，在于全局变量的作用域生存期很长，在模块内随时都可以访问，而父函数的局部作用域在父函数执行完毕后便会直接释放，因此 <code>nonlocal</code> 语句必须将父函数变量的标识符和引用写入闭包命名空间。</p>
<h3 id="_10">类的局部命名空间</h3>
<p>首先，函数和类执行时都会产生局部命名空间，但类的执行机制不同于函数：</p>
<div class="codehilite"><pre><span></span><span class="o">#</span><span class="n">i</span><span class="p">.</span><span class="n">py</span>
<span class="n">def</span> <span class="n">a</span><span class="p">():</span>
    <span class="n">print</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="n">A</span><span class="p">():</span>
    <span class="n">print</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">class</span> <span class="n">B</span><span class="p">():</span>
        <span class="n">print</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">class</span> <span class="k">C</span><span class="p">():</span>
            <span class="n">print</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>执行文件，结果为：</p>
<div class="codehilite"><pre><span></span><span class="err">1</span>
<span class="err">2</span>
<span class="err">3</span>
</pre></div>


<p>如上，类就是一个可执行的代码块，只要该类被加载，就会被执行，这一点不同于函数。
类之所以这么设计的原因在于：类是创建其他实例（生成其他的类或者具体的对象）的对象，因此必须在实例之前被创建，而类又可能涉及到与其他类的继承、重载等一系列问题，故在代码加载时就被创建利于提高效率和降低逻辑复杂度。</p>
<p>其次，与函数不同的是，类的局部命名空间并非作用域</p>
<div class="codehilite"><pre><span></span><span class="err">class A():</span>
<span class="err">    a = 1</span>
<span class="err">    b = [a + i for i in range(3)]  #NameError: name &#39;a&#39; is not defined</span>
</pre></div>


<p>执行上段代码，我们可以发现在类 <code>A</code> 内列表推导式无法调取 <code>a</code> 的值，但函数却可以：</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">func</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">func</span><span class="p">()</span>  <span class="o">#</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>


<p>因此，<code>A</code> 中的 <code>a</code> 不同于函数 <code>func</code> 中的 <code>a</code> 在局部命名空间中可以被任意读取，之所以说是“不可以被任意”读取而不是“不可被读取”，原因在于在类<code>A</code> 的局部空间内，<code>a</code> 其实一定程度上是可以直接被读取的：</p>
<div class="codehilite"><pre><span></span><span class="err">class A():</span>
<span class="err">    a = 1</span>
<span class="err">    c = a + 2</span>
</pre></div>


<p>执行上段代码后：</p>
<div class="codehilite"><pre><span></span><span class="err">A.c </span>
<span class="err">#3</span>
</pre></div>


<p>而上例中 <code>b</code> 的赋值操作不能执行，原因在于列表推导式会创建自己的局部命名空间，因此难以访问到 <code>a</code>。</p>
<h3 id="_11">总结</h3>
<p>啰嗦了这么多，终于该结尾了！
我们再来回过头来看下文章开头的栗子：
1、为什么 b.py 只是导入 a.py 中的 <code>class A</code>,却执行了整个 a.py 文件?
答：因为 Python 并不知道 <code>class A</code> 在 a.py 文档的何处，为了能够找到 <code>class A</code>，Python 需要执行整个文档。
2、为什么 b.py 的导入执行了整个 a.py 文档，却在 b 中难以调用 a 的全局变量 <code>va</code>？
答：Python 的全局变量指的是模块全局，因此不可以跨文档，因此 global 语句也是不可以跨文档的。另外， b 只是导入了 a 的 <code>class A</code>，因此并不会导入 a 中所有的标识符，所以 类似<code>a.va</code> 这样的调用也是不起作用的。</p>
<p>关于命名空间：
1、赋值、定义类和函数都会产生新的标识符；
2、全局变量的标识符不能跨文档；
3、各级命名空间相互独立互不影响；
4、Python 总是从当前层逐渐向上寻找标识符；
5、内层作用域若想直接修改上层变量，需要通过 <code>global</code> <code>nonlocal</code> 语句先声明；
6、单纯的 <code>global</code> 语句并不能为所在层级创建相应标识符，但 <code>nonlocal</code> 语句可以在闭包空间中创建相应标识符；
7、类的局部命名空间不是作用域。</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="1.3.编译型语言和解释型语言的优缺点对比.html" title="1.3.编译型语言和解释型语言的优缺点对比" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                1.3.编译型语言和解释型语言的优缺点对比
              </span>
            </div>
          </a>
        
        
          <a href="1.5.字符编码.html" title="1.5.字符编码" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                1.5.字符编码
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../javascript/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>