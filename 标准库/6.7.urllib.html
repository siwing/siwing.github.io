
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.6">
    
    
      
        <title>6.7.urllib - Python笔记</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.875de78c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#request" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Python笔记" class="md-header__button md-logo" aria-label="Python笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6.7.urllib
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/siwing/siwing.github.io/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Python笔记" class="md-nav__button md-logo" aria-label="Python笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Python笔记
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/siwing/siwing.github.io/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        计算机基础
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="计算机基础" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          计算机基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/1.1.CPU.html" class="md-nav__link">
        1.1.CPU
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/1.2.Memory.html" class="md-nav__link">
        1.2.Memory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/1.3.%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.html" class="md-nav__link">
        1.3.基本概念
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/1.4.%E7%BC%96%E8%AF%91%E5%9E%8B%E8%AF%AD%E8%A8%80%E5%92%8C%E8%A7%A3%E9%87%8A%E5%9E%8B%E8%AF%AD%E8%A8%80%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94.html" class="md-nav__link">
        1.4.编译型语言 vs 解释型语言
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/1.5.%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81.html" class="md-nav__link">
        1.5.字符编码
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Python基础
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python基础" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Python基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.1.Python%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95.html" class="md-nav__link">
        2.1.Python基本语法
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.2.%E8%AF%AD%E5%8F%A5.html" class="md-nav__link">
        2.2.语句
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.3.%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" class="md-nav__link">
        2.3.数据类型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.4.Number.html" class="md-nav__link">
        2.4.Number
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.5.String.html" class="md-nav__link">
        2.5.String
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.6.List.html" class="md-nav__link">
        2.6.List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.7.Tuple.html" class="md-nav__link">
        2.7.Tuple
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.8.Dict.html" class="md-nav__link">
        2.8.Dict
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.9.%E7%AE%80%E6%B4%81%E7%9A%84Python.html" class="md-nav__link">
        2.9.简洁的Python
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.10.%E8%B5%8B%E5%80%BC%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D.html" class="md-nav__link">
        2.10.赋值与深拷贝
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.11.%E5%87%BD%E6%95%B0.html" class="md-nav__link">
        2.11.函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.12.%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0.html" class="md-nav__link">
        2.12.内置函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/2.13.%E7%AE%80%E6%B4%81%E7%9A%84Python.html" class="md-nav__link">
        2.13.简洁的Python
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/3.1.%E5%BC%82%E5%B8%B8.html" class="md-nav__link">
        3.1.异常
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/3.2.%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F.html" class="md-nav__link">
        3.2.命名空间和作用域
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/3.3.%E9%97%AD%E5%8C%85.html" class="md-nav__link">
        3.3.闭包
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/3.4.%E8%A3%85%E9%A5%B0%E5%99%A8.html" class="md-nav__link">
        3.4.装饰器
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/4.1.%E7%B1%BB.html" class="md-nav__link">
        4.1.类
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/4.2.%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF%E5%92%8CMRO.html" class="md-nav__link">
        4.2.多重继承和MRO
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/4.3.%E6%A8%A1%E5%9D%97.html" class="md-nav__link">
        4.3.模块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Python%E5%9F%BA%E7%A1%80/4.4.%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95.html" class="md-nav__link">
        4.4.魔术方法
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        开发环境管理
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="开发环境管理" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          开发环境管理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/5.1.conda%E7%AC%94%E8%AE%B0.html" class="md-nav__link">
        5.1.conda笔记
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/5.2.pip%E7%AC%94%E8%AE%B0.html" class="md-nav__link">
        5.2.pip笔记
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/5.3.pip%E5%AF%B9%E6%AF%94conda.html" class="md-nav__link">
        5.3.pip对比conda
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/5.4.anaconda.html" class="md-nav__link">
        5.4.anaconda
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/5.5.jupyter%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0.html" class="md-nav__link">
        5.5.jupyter使用笔记
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        标准库
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="标准库" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          标准库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.1.string.html" class="md-nav__link">
        6.1.string
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.2.textwrap.html" class="md-nav__link">
        6.2.textwrap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.3.time.html" class="md-nav__link">
        6.3.time
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.4.datetime.html" class="md-nav__link">
        6.4.datetime
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.5.calendar.html" class="md-nav__link">
        6.5.calendar
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          6.7.urllib
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="6.7.urllib.html" class="md-nav__link md-nav__link--active">
        6.7.urllib
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    request 模块
  </a>
  
    <nav class="md-nav" aria-label="request 模块">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#urlopen" class="md-nav__link">
    urlopen
  </a>
  
    <nav class="md-nav" aria-label="urlopen">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    data 参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    timeout 参数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_1" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler" class="md-nav__link">
    Handler
  </a>
  
    <nav class="md-nav" aria-label="Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    验证
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    代理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookies" class="md-nav__link">
    Cookies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    处理异常
  </a>
  
    <nav class="md-nav" aria-label="处理异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#urlerror" class="md-nav__link">
    URLError
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httperror" class="md-nav__link">
    HTTPError
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    解析链接
  </a>
  
    <nav class="md-nav" aria-label="解析链接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#urlparse" class="md-nav__link">
    urlparse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlunparse" class="md-nav__link">
    urlunparse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlsplit" class="md-nav__link">
    urlsplit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlunsplit" class="md-nav__link">
    urlunsplit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urljoin" class="md-nav__link">
    urljoin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlencode" class="md-nav__link">
    urlencode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_qs" class="md-nav__link">
    parse_qs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_qsl" class="md-nav__link">
    parse_qsl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quote" class="md-nav__link">
    quote
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unquote" class="md-nav__link">
    unquote
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#robots" class="md-nav__link">
    分析 Robots 协议
  </a>
  
    <nav class="md-nav" aria-label="分析 Robots 协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#robots_1" class="md-nav__link">
    Robots 协议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    爬虫名称
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robotparser" class="md-nav__link">
    robotparser
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.8.requests.html" class="md-nav__link">
        6.8.requests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.9.re.html" class="md-nav__link">
        6.9.re
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.10.os_path.html" class="md-nav__link">
        6.10.os.path
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.11.traceback.html" class="md-nav__link">
        6.11.traceback
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.12.enum.html" class="md-nav__link">
        6.12.enum
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.13.difflib%E2%80%94%E2%80%94%E5%AD%97%E7%AC%A6%E6%AF%94%E8%BE%83.html" class="md-nav__link">
        6.13.difflib——字符比较
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.14.logging.html" class="md-nav__link">
        6.14.logging
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.15.Compression_Archiving.html" class="md-nav__link">
        6.15.Compression_Archiving
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="6.16.shutil.html" class="md-nav__link">
        6.16.shutil
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        设计模式
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="设计模式" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          设计模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/7.1.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%9F%BA%E7%A1%80.html" class="md-nav__link">
        7.1.面向对象程序设计基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/7.2.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99.html" class="md-nav__link">
        7.2.面向对象软件设计原则
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/7.3.%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F.html" class="md-nav__link">
        7.3.创建型模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../设计模式/7.4.结构型模式.md" class="md-nav__link">
        7.4.结构型模式
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        NumPy
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="NumPy" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          NumPy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.1.%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84.html" class="md-nav__link">
        8.1.创建数组
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.2.%E7%B4%A2%E5%BC%95.html" class="md-nav__link">
        8.2.索引
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.3.%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.html" class="md-nav__link">
        8.3.内存布局
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.4.%E5%B9%BF%E6%92%AD.html" class="md-nav__link">
        8.4.广播
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.5.%E5%B8%B8%E9%87%8F.html" class="md-nav__link">
        8.5.常量
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.6.%E6%89%93%E5%8D%B0%E6%95%B0%E7%BB%84.html" class="md-nav__link">
        8.6.打印数组
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.7.%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C.html" class="md-nav__link">
        8.7.数组操作
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.8.ufunc%E5%87%BD%E6%95%B0.html" class="md-nav__link">
        8.8.ufunc函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.9.%E5%87%BD%E6%95%B0%E5%BA%93.html" class="md-nav__link">
        8.9.函数库
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.10.%E4%BF%9D%E5%AD%98%E5%92%8C%E5%8A%A0%E8%BD%BD.html" class="md-nav__link">
        8.10.保存和加载
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.11.%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E7%BB%84.html" class="md-nav__link">
        8.11.结构化数组
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../NumPy/8.12.%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86.html" class="md-nav__link">
        8.12.数据处理
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        pandas
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="pandas" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          pandas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.1.Series.html" class="md-nav__link">
        9.1.Series
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.2.DataFra.html" class="md-nav__link">
        9.2.DataFra
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.3.%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE.html" class="md-nav__link">
        9.3.选择数据
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.4.%E7%B4%A2%E5%BC%95%E5%AF%B9%E8%B1%A1.html" class="md-nav__link">
        9.4.索引对象
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.5.%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E8%BF%9B%E9%98%B6.html" class="md-nav__link">
        9.5.选择数据进阶
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.6.%E7%B4%A2%E5%BC%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C.html" class="md-nav__link">
        9.6.索引的基本操作
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.7.%E6%8B%BC%E6%8E%A5.html" class="md-nav__link">
        9.7.拼接
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.8.%E5%8F%98%E6%8D%A2%E7%B4%A2%E5%BC%95.html" class="md-nav__link">
        9.8.变换索引
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.9.%E5%88%86%E7%BB%84%E4%B8%8E%E8%81%9A%E5%90%88.html" class="md-nav__link">
        9.9.分组与聚合
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.10.%E7%BB%98%E5%9B%BE.html" class="md-nav__link">
        9.10.绘图
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pandas/9.11.%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86.html" class="md-nav__link">
        9.11.数据处理
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Matplotlib
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Matplotlib" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Matplotlib
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Matplotlib/10.1.%E6%9E%B6%E6%9E%84.html" class="md-nav__link">
        10.1.架构
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Matplotlib/10.2.plot.html" class="md-nav__link">
        10.2.plot
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        scikit-learn
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="scikit-learn" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          scikit-learn
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.1.%E6%95%B0%E6%8D%AE%E9%9B%86.html" class="md-nav__link">
        11.1.数据集
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.2.%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87.html" class="md-nav__link">
        11.2.评价指标-分类
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.5.%E6%8B%86%E5%88%86%E6%95%B0%E6%8D%AE.html" class="md-nav__link">
        11.5.拆分数据
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.6.%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81.html" class="md-nav__link">
        11.6.交叉验证
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.7.%E8%B6%85%E5%8F%82%E6%95%B0%E5%AF%BB%E4%BC%98.html" class="md-nav__link">
        11.7.超参数寻优
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.8.%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B.html" class="md-nav__link">
        11.8.保存模型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.9.%E7%89%B9%E5%BE%81%E5%A4%84%E7%90%86.html" class="md-nav__link">
        11.9.特征处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.10.%E8%BD%AC%E6%8D%A2%E9%A2%84%E6%B5%8B%E7%9B%AE%E6%A0%87y.html" class="md-nav__link">
        11.10.转换预测目标y
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.11.%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9.html" class="md-nav__link">
        11.11.特征选择
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.12.%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96.html" class="md-nav__link">
        11.12.特征提取
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.13.%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%A4%84%E7%90%86.html" class="md-nav__link">
        11.13.缺失值处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.14.%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92.html" class="md-nav__link">
        11.14.线性回归
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scikit-learn/11.15.%E5%86%B3%E7%AD%96%E6%A0%91.html" class="md-nav__link">
        11.15.决策树
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        tensorflow笔记
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="tensorflow笔记" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          tensorflow笔记
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow%E7%AC%94%E8%AE%B0/12.1.keras%E6%95%B0%E6%8D%AE%E9%9B%86.html" class="md-nav__link">
        12.1.keras数据集
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow%E7%AC%94%E8%AE%B0/12.2.%E5%88%9B%E5%BB%BA%E5%BC%A0%E9%87%8F.html" class="md-nav__link">
        12.2.创建张量
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow%E7%AC%94%E8%AE%B0/12.3.%E5%BC%A0%E9%87%8F%E8%BF%9B%E9%98%B6%E6%93%8D%E4%BD%9C.html" class="md-nav__link">
        12.3.张量进阶操作
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow%E7%AC%94%E8%AE%B0/12.4.%E6%B1%82%E5%AF%BC.html" class="md-nav__link">
        12.4.求导
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow%E7%AC%94%E8%AE%B0/12.5.%E5%8F%AF%E7%94%A8%E6%80%A7%E6%B5%8B%E8%AF%95.html" class="md-nav__link">
        12.5.可用性测试
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow%E7%AC%94%E8%AE%B0/12.6.Perceptron.html" class="md-nav__link">
        12.6.Perceptron
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tensorflow%E7%AC%94%E8%AE%B0/12.7.keras%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.html" class="md-nav__link">
        12.7.keras快速开始
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        爬虫
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="爬虫" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          爬虫
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%88%AC%E8%99%AB/13.1.lxml.html" class="md-nav__link">
        13.1.lxml
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E7%88%AC%E8%99%AB/13.3.pyquery.html" class="md-nav__link">
        13.3.pyquery
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      <label class="md-nav__link" for="__nav_13">
        gensim
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="gensim" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          gensim
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gensim/14.1.word2vec%20model.html" class="md-nav__link">
        14.1.word2vec model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gensim/14.2.word2vec%E5%8F%82%E6%95%B0.html" class="md-nav__link">
        14.2.word2vec参数
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" type="checkbox" id="__nav_14" >
      
      <label class="md-nav__link" for="__nav_14">
        数据库
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="数据库" data-md-level="1">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          数据库
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/15.1.DBAPI.html" class="md-nav__link">
        15.1.DBAPI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/15.2.PostgreSQL.html" class="md-nav__link">
        15.2.PostgreSQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/15.3.MSSQL.html" class="md-nav__link">
        15.3.MSSQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/15.4.SQLite.html" class="md-nav__link">
        15.4.SQLite
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%95%B0%E6%8D%AE%E5%BA%93/15.5.SQLAlchemy.html" class="md-nav__link">
        15.5.SQLAlchemy
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      <label class="md-nav__link" for="__nav_15">
        文件操作
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="文件操作" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          文件操作
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/16.2.PDF.html" class="md-nav__link">
        16.2.PDF
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/16.3.docx.html" class="md-nav__link">
        16.3.docx
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/16.4.OCR.html" class="md-nav__link">
        16.4.OCR
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_16" type="checkbox" id="__nav_16" >
      
      <label class="md-nav__link" for="__nav_16">
        Docker
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Docker" data-md-level="1">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Docker/17.2.Dockerfile.html" class="md-nav__link">
        17.2.Dockerfile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Docker/17.3.Image.html" class="md-nav__link">
        17.3.Image
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_17" type="checkbox" id="__nav_17" >
      
      <label class="md-nav__link" for="__nav_17">
        Linux
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_17">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/18.1.%E7%9B%AE%E5%BD%95%E8%A7%84%E8%8C%83.html" class="md-nav__link">
        18.1.目录规范
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    request 模块
  </a>
  
    <nav class="md-nav" aria-label="request 模块">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#urlopen" class="md-nav__link">
    urlopen
  </a>
  
    <nav class="md-nav" aria-label="urlopen">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    data 参数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    timeout 参数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_1" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler" class="md-nav__link">
    Handler
  </a>
  
    <nav class="md-nav" aria-label="Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    验证
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    代理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookies" class="md-nav__link">
    Cookies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    处理异常
  </a>
  
    <nav class="md-nav" aria-label="处理异常">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#urlerror" class="md-nav__link">
    URLError
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#httperror" class="md-nav__link">
    HTTPError
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    解析链接
  </a>
  
    <nav class="md-nav" aria-label="解析链接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#urlparse" class="md-nav__link">
    urlparse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlunparse" class="md-nav__link">
    urlunparse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlsplit" class="md-nav__link">
    urlsplit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlunsplit" class="md-nav__link">
    urlunsplit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urljoin" class="md-nav__link">
    urljoin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urlencode" class="md-nav__link">
    urlencode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_qs" class="md-nav__link">
    parse_qs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_qsl" class="md-nav__link">
    parse_qsl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quote" class="md-nav__link">
    quote
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unquote" class="md-nav__link">
    unquote
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#robots" class="md-nav__link">
    分析 Robots 协议
  </a>
  
    <nav class="md-nav" aria-label="分析 Robots 协议">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#robots_1" class="md-nav__link">
    Robots 协议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    爬虫名称
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robotparser" class="md-nav__link">
    robotparser
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/siwing/siwing.github.io/edit/master/docs/标准库/6.7.urllib.md" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>6.7.urllib</h1>
                
                <div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">urllib</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Windows 10
Python 3.6.9 @ MSC v.1915 64 bit (AMD64)
Latest build date 2020.06.13
</code></pre></div>
<p>在 Python 2 中，有 urllib 和 urllib2 两个库来实现请求的发送。而在 Python 3 中，已经不存在 urllib2 这个库了，统一为 urllib，<a href="https://docs.python.org/3/library/urllib.html">这是urllib的官方文档链接</a>。</p>
<p>urllib 库是 Python 内置的 HTTP 请求库，它包含如下 4 个模块：</p>
<ol>
<li><strong>request</strong>：它是最基本的 HTTP 请求模块，可以用来模拟发送请求。就像在浏览器里输入网址然后回车一样，只需要给库方法传入 URL 以及额外的参数，就可以模拟实现这个过程了。</li>
<li><strong>error</strong>：异常处理模块，如果出现请求错误，我们可以捕获这些异常，然后进行重试或其他操作以保证程序不会意外终止。</li>
<li><strong>parse</strong>：一个工具模块，提供了许多 URL 处理方法，比如拆分、解析、合并等。</li>
<li><strong>robotparser</strong>：主要是用来识别网站的 robots.txt 文件，然后判断哪些网站可以爬，哪些网站不可以爬，用得比较少。</li>
</ol>
<h2 id="request">request 模块</h2>
<p><a href="https://docs.python.org/3/library/urllib.request.html">hurllib.request</a> 模块提供了最基本的构造 HTTP 请求的方法，利用它可以模拟浏览器的一个请求发起过程，同时它还带有处理授权验证（authentication）、重定向（redirection)、浏览器 Cookies 以及其他内容。</p>
<h3 id="urlopen">urlopen</h3>
<div class="highlight"><pre><span></span><code><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">timeout</span><span class="p">,]</span><span class="o">*</span><span class="p">,</span> <span class="n">cafile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">capath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">cadefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># data    附加数据</span>
<span class="c1"># timeout 超时时间</span>
<span class="c1"># context 必须是 ssl.SSLContext 类型，用来指定 SSL 设置</span>
<span class="c1"># cafile 和 capath 分别指定 CA 证书和它的路径，这个在请求 HTTPS 链接时会有用</span>
<span class="c1"># cadefault 现在已经弃用了，其默认值为 False</span>
</code></pre></div>
<p>例如，要请求 Python 官网：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">urllib.request</span>  

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.python.org&#39;</span>
<span class="c1"># response是一个 HTTPResposne 类型的对象</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># 读入网页内容 这是一个bytes字符串</span>
<span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1"># 响应的状态码</span>
<span class="n">response</span><span class="o">.</span><span class="n">status</span>
<span class="c1"># 响应的状态信息</span>
<span class="n">response</span><span class="o">.</span><span class="n">reason</span>
<span class="c1"># 响应的头信息</span>
<span class="n">response</span><span class="o">.</span><span class="n">getheaders</span><span class="p">()</span>
<span class="c1"># 获取响应的头信息的某个参数</span>
<span class="n">response</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&#39;nginx&#39;
</code></pre></div>
<p>主要包含 readinto、fileno 等方法，以及 msg、version、debuglevel、closed 等属性。</p>
<h4 id="data">data 参数</h4>
<p>如果要添加<code>data</code>参数，需要使用 bytes 方法将参数转化为字节流编码格式的内容，即 bytes 类型。另外，如果传递了这个参数，请求方式就不再是 GET 方式，而是 POST 方式。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># import urllib.parse  </span>
<span class="kn">import</span> <span class="nn">urllib.request</span>  

<span class="c1"># 使用了 bytes 方法编码成字节流</span>
<span class="c1"># data = bytes(urllib.parse.urlencode({&#39;word&#39;: &#39;hello&#39;}), encoding=&#39;utf8&#39;)  </span>
<span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;word=hello&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/post&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{
  &quot;args&quot;: {},
  &quot;data&quot;: &quot;&quot;,
  &quot;files&quot;: {},
  &quot;form&quot;: {
    &quot;word&quot;: &quot;hello&quot;
  },
  &quot;headers&quot;: {
    &quot;Accept-Encoding&quot;: &quot;identity&quot;,
    &quot;Content-Length&quot;: &quot;10&quot;,
    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,
    &quot;Host&quot;: &quot;httpbin.org&quot;,
    &quot;User-Agent&quot;: &quot;Python-urllib/3.6&quot;,
    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-5ee46694-38358ae8257a47e8d0f88538&quot;
  },
  &quot;json&quot;: null,
  &quot;origin&quot;: &quot;157.122.62.84&quot;,
  &quot;url&quot;: &quot;http://httpbin.org/post&quot;
}
</code></pre></div>
<p>请求的 URL 为：<a href="http://httpbin.org/post">http://httpbin.org/post</a>，这个链接可以用来测试 POST 请求，它可以输出 Request 的一些信息，其中就包含传递的 data 参数。</p>
<p>我们传递的参数出现在了 form 字段中，这表明是模拟了表单提交的方式，以 POST 方式传输数据。</p>
<h4 id="timeout">timeout 参数</h4>
<p>timeout 参数用于设置超时时间，单位为秒，意思就是如果请求超出了设置的这个时间，还没有得到响应，就会抛出 URLError 异常，URLError 异常属于 urllib.error 模块。如果不指定该参数，就会使用全局默认时间。它支持 HTTP、HTTPS、FTP 请求。</p>
<blockquote>
<p>全局默认时间可以为<code>None</code>，表示无超时限制。但即使全局默认时间为<code>None</code>，最后可能还是会发生超时，此时超时可能是HTTP网络超时。而不是超过了限定的时间。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">urllib.request</span>  

<span class="c1"># 1秒内得到响应，则不会抛出URLError 异常</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TIME OUT&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{
  &quot;args&quot;: {},
  &quot;headers&quot;: {
    &quot;Accept-Encoding&quot;: &quot;identity&quot;,
    &quot;Host&quot;: &quot;httpbin.org&quot;,
    &quot;User-Agent&quot;: &quot;Python-urllib/3.6&quot;,
    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-5ee46694-4499269c47c50804469a0aea&quot;
  },
  &quot;origin&quot;: &quot;157.122.62.84&quot;,
  &quot;url&quot;: &quot;http://httpbin.org/get&quot;
}
</code></pre></div>
<p>可以通过设置这个超时时间来控制一个网页如果长时间未响应，就跳过它的抓取。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># need to fix. output should be &#39;TIME OUT 1&#39;</span>
<span class="kn">import</span> <span class="nn">socket</span>  
<span class="kn">import</span> <span class="nn">urllib.request</span>  
<span class="kn">import</span> <span class="nn">urllib.error</span>  

<span class="k">try</span><span class="p">:</span>  
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">):</span>  
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TIME OUT 1&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TIME OUT 2&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>TIME OUT 1
</code></pre></div>
<p>一般来说，0.1 秒内基本不可能得到服务器响应，因此输出了 TIME OUT 的提示。</p>
<h3 id="request_1">Request</h3>
<p>利用 urlopen 方法可以实现最基本请求的发起，但这几个简单的参数并不足以构建一个完整的请求。如果请求中需要加入 Headers 等信息，可以利用更强大的 Request 类来构建。</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">urllib.request</span>  

<span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s1">&#39;https://python.org&#39;</span><span class="p">)</span>  
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;!doctype html&gt;
&lt;!--[if lt IE 7]&gt;   &lt;html class=&quot;no-js ie6 lt-ie7 lt-ie8 lt-ie9&quot;&gt;
&lt;![endif]--&gt;
&lt;!--[if IE 7]&gt;      &lt;html class=&quot;no-js ie7 lt-ie8 lt-ie9&quot;&gt;
&lt;![endif]--&gt;
&lt;!--[if IE 8]&gt;      &lt;html class=&quot;no-js ie8 lt-ie9&quot;&gt;
&lt;![endif]--&gt;
&lt;!--[if gt IE 8]&gt;&lt;!--&gt;&lt;html class=&quot;no-js&quot;
                         .
                         .
                         .
0be1d290.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;


    &lt;![endif]--&gt;






&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
<p>依然是用 urlopen 方法来发送这个请求，只不过这次该方法的参数不再是 URL，而是一个 Request 类型的对象。通过构造这个数据结构，一方面我们可以将请求独立成一个对象，另一方面可更加丰富和灵活地配置参数。</p>
<p>Request 的构造方法如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>   
                             <span class="n">origin_req_host</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unverifiable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
<p><code>url</code>：用于请求 URL，这是必传参数，其他都是可选参数。</p>
<p><code>data</code>：bytes（字节流）类型。如果它是字典，可以先用 urllib.parse 模块里的 urlencode() 编码。</p>
<p><code>headers</code>：它是一个字典，也就是请求头，我们可以在构造请求时通过 headers 参数直接构造，也可以通过调用请求实例的 add_header() 方法添加。添加请求头最常用的用法就是通过修改 User-Agent 来伪装浏览器，默认的 User-Agent 是 Python-urllib，我们可以通过修改它来伪装浏览器。比如要伪装火狐浏览器，可以把它设置为：</p>
<div class="highlight"><pre><span></span><code>Mozilla/5.0 (X11; U; Linux i686) Gecko/20071127 Firefox/2.0.0.11
</code></pre></div>
<p><code>origin_req_host</code>：指的是请求方的 host 名称或者 IP 地址。</p>
<p><code>unverifiable</code>：表示这个请求是否是无法验证的，默认是 False，意思就是说用户没有足够权限来选择接收这个请求的结果。例如，我们请求一个 HTML 文档中的图片，但是我们没有自动抓取图像的权限，这时 unverifiable 的值就是 True。</p>
<p><code>method</code>：是一个字符串，用来指示请求使用的方法，比如 GET、POST 和 PUT 等。</p>
<p>下面我们传入多个参数构建请求来看一下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">parse</span>  

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/post&#39;</span>  
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&#39;</span><span class="p">,</span>  
           <span class="s1">&#39;Host&#39;</span><span class="p">:</span> <span class="s1">&#39;httpbin.org&#39;</span><span class="p">}</span>  
<span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Germey&#39;</span><span class="p">}</span>  
<span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="nb">dict</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="c1"># data = b&#39;name=Germey&#39;</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">)</span>  
<span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{
  &quot;args&quot;: {},
  &quot;data&quot;: &quot;&quot;,
  &quot;files&quot;: {},
  &quot;form&quot;: {
    &quot;name&quot;: &quot;Germey&quot;
  },
  &quot;headers&quot;: {
    &quot;Accept-Encoding&quot;: &quot;identity&quot;,
    &quot;Content-Length&quot;: &quot;11&quot;,
    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,
    &quot;Host&quot;: &quot;httpbin.org&quot;,
    &quot;User-Agent&quot;: &quot;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&quot;,
    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-5ee46699-5c8f13e39c460e544f38df00&quot;
  },
  &quot;json&quot;: null,
  &quot;origin&quot;: &quot;157.122.62.84&quot;,
  &quot;url&quot;: &quot;http://httpbin.org/post&quot;
}
</code></pre></div>
<p>这里我们通过 4 个参数构造了一个请求，其中 url 即请求 URL，headers 中指定了 User-Agent 和 Host，参数 data 用 urlencode 和 bytes 方法转成字节流。另外，指定了请求方式为 POST。</p>
<p>观察结果可以发现，我们成功设置了 data、headers 和 method。</p>
<p>另外，headers 也可以用 add_header 方法来添加：</p>
<div class="highlight"><pre><span></span><code><span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s1">&#39;Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="handler">Handler</h3>
<p>在上面的过程中，虽然可以构造请求，但如果要处理一些更高级的操作（比如 Cookies 处理、代理设置等），则需要 Handler 。我们可以把 Handler 理解为各种处理器，有专门处理登录验证的，有处理 Cookies 的，有处理代理设置的。利用它们，我们几乎可以做到 HTTP 请求中所有的事情。</p>
<p>urllib.request 模块里的 BaseHandler 类是所有其他 Handler 的父类，它提供了最基本的方法，例如 default_open、protocol_request 等。</p>
<p>接下来，就有各种 Handler 子类继承这个 BaseHandler 类，举例如下：</p>
<ul>
<li>HTTPDefaultErrorHandler 用于处理 HTTP 响应错误，错误都会抛出 HTTPError 类型的异常。</li>
<li>HTTPRedirectHandler 用于处理重定向。</li>
<li>HTTPCookieProcessor 用于处理 Cookies。</li>
<li>ProxyHandler 用于设置代理，默认代理为空。</li>
<li>HTTPPasswordMgr 用于管理密码，它维护了用户名密码的表。</li>
<li>HTTPBasicAuthHandler 用于管理认证，如果一个链接打开时需要认证，那么可以用它来解决认证问题。</li>
</ul>
<p>另外还有其他的 Handler 类，在这不一一列举了，详情可以参考官方文档： <a href="https://docs.python.org/3/library/urllib.request.html#urllib.request.BaseHandler">https://docs.python.org/3/library/urllib.request.html#urllib.request.BaseHandler</a></p>
<p>关于怎么使用它们，现在先不用着急，后面会有实例演示。</p>
<p>另一个比较重要的类就是 OpenerDirector，我们可以称为 Opener。我们之前用过 urlopen 这个方法，实际上它就是 urllib 为我们提供的一个 Opener。</p>
<p>那么，为什么要引入 Opener 呢？因为需要实现更高级的功能。之前使用的 Request 和 urlopen 相当于类库为你封装好了极其常用的请求方法，利用它们可以完成基本的请求，但是现在不一样了，我们需要实现更高级的功能，所以需要深入一层进行配置，使用更底层的实例来完成操作，所以这里就用到了 Opener。</p>
<p>Opener 可以使用 open 方法，返回的类型和 urlopen 如出一辙。那么，它和 Handler 有什么关系呢？简而言之，就是利用 Handler 来构建 Opener。</p>
<p>下面用几个实例来看看它们的用法。</p>
<h4 id="_1">验证</h4>
<p>有些网站在打开时就会弹出提示框，直接提示你输入用户名和密码，验证成功后才能查看页面，如图所示：</p>
<p><img src="figures/登录验证.png" alt="登录验证" style="zoom: 90%;" /></p>
<p>HTTPBasicAuthHandler 就可以请求这样的页面：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">HTTPPasswordMgrWithDefaultRealm</span><span class="p">,</span> <span class="n">HTTPBasicAuthHandler</span><span class="p">,</span> <span class="n">build_opener</span>
    <span class="p">)</span>
<span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">URLError</span>  

<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span>  
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;12345678&#39;</span>  
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://httpbin.org/basic-auth/name/12345678&#39;</span>  

<span class="n">p</span> <span class="o">=</span> <span class="n">HTTPPasswordMgrWithDefaultRealm</span><span class="p">()</span>  
<span class="n">p</span><span class="o">.</span><span class="n">add_password</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>  
<span class="n">auth_handler</span> <span class="o">=</span> <span class="n">HTTPBasicAuthHandler</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>  
<span class="n">opener</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">auth_handler</span><span class="p">)</span>  

<span class="k">try</span><span class="p">:</span>  
    <span class="n">result</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>  
    <span class="n">html</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{
  &quot;authenticated&quot;: true,
  &quot;user&quot;: &quot;name&quot;
}
</code></pre></div>
<p>这里首先实例化 HTTPBasicAuthHandler 对象，其参数是 HTTPPasswordMgrWithDefaultRealm 对象，它利用 add_password 方法添加进去用户名和密码，这样就建立了一个处理验证的 Handler。</p>
<p>接下来，利用这个 Handler 并使用 build_opener 方法构建一个 Opener，这个 Opener 在发送请求时就相当于已经验证成功了。</p>
<p>接下来，利用 Opener 的 open 方法打开链接，就可以完成验证了。这里获取到的结果就是验证后的页面源码内容。</p>
<h4 id="_2">代理</h4>
<p>在做爬虫的时候，免不了要使用代理，如果要添加代理，可以这样做：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">URLError</span>  
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">ProxyHandler</span><span class="p">,</span> <span class="n">build_opener</span>  

<span class="n">proxy_handler</span> <span class="o">=</span> <span class="n">ProxyHandler</span><span class="p">({</span>  
    <span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:9743&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;https&#39;</span><span class="p">:</span> <span class="s1">&#39;https://127.0.0.1:9743&#39;</span>  
<span class="p">})</span>  
<span class="n">opener</span> <span class="o">=</span> <span class="n">build_opener</span><span class="p">(</span><span class="n">proxy_handler</span><span class="p">)</span>  
<span class="k">try</span><span class="p">:</span>  
    <span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;https://www.baidu.com&#39;</span><span class="p">)</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>  
<span class="k">except</span> <span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[WinError 10061] No connection could be made because the target
machine actively refused it
</code></pre></div>
<p>这里我们在本地搭建了一个代理，它运行在 9743 端口上。</p>
<p>这里使用了 ProxyHandler，其参数是一个字典，键名是协议类型（比如 HTTP 或者 HTTPS 等），键值是代理链接，可以添加多个代理。</p>
<p>然后，利用这个 Handler 及 build_opener 方法构造一个 Opener，之后发送请求即可。</p>
<h4 id="cookies">Cookies</h4>
<p>获取网站的 Cookies，相关代码如下：</p>
<p>首先，我们必须声明一个 CookieJar 对象。接下来，就需要利用 HTTPCookieProcessor 来构建一个 Handler，最后利用 build_opener 方法构建出 Opener，执行 open 函数即可。    </p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">http.cookiejar</span><span class="o">,</span> <span class="nn">urllib.request</span>  

<span class="n">cookie</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">cookiejar</span><span class="o">.</span><span class="n">CookieJar</span><span class="p">()</span>  
<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>  
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>  
<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">)</span>  
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cookie</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">+</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>BAIDUID=A5F653A099838B93FFDFA2E2E5DF2B7F:FG=1
BIDUPSID=A5F653A099838B93B7152CE45EB47D2A
H_PS_PSSID=31906_1420_31669_21080_31069_31253_31765_32045_30823_26350
PSTM=1592026781
BDSVRTM=0
BD_HOME=1
</code></pre></div>
<p>可以看到，这里输出了每条 Cookie 的名称和值。</p>
<p>不过既然能输出，那可不可以输出成文件格式呢？我们知道 Cookies 实际上也是以文本形式保存的。</p>
<p>答案当然是肯定的，这里通过下面的实例来看看：</p>
<div class="highlight"><pre><span></span><code><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;cookies.txt&#39;</span>  
<span class="n">cookie</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">cookiejar</span><span class="o">.</span><span class="n">MozillaCookieJar</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  
<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>  
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>  
<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">)</span>  
<span class="n">cookie</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ignore_discard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>这时 CookieJar 就需要换成 MozillaCookieJar，它在生成文件时会用到，是 CookieJar 的子类，可以用来处理 Cookies 和文件相关的事件，比如读取和保存 Cookies，可以将 Cookies 保存成 Mozilla 型浏览器的 Cookies 格式。</p>
<p>运行之后，可以发现生成了一个 cookies.txt 文件，其内容如下：</p>
<div class="highlight"><pre><span></span><code># Netscape HTTP Cookie File  
# http://curl.haxx.se/rfc/cookie_spec.html  
# This is a generated file!  Do not edit.  

.baidu.com       TRUE   / FALSE   3622386254    BAIDUID     05AE39B5F56C1DEC474325CDA522D44F:FG=1  
.baidu.com       TRUE   / FALSE   3622386254    BIDUPSID    05AE39B5F56C1DEC474325CDA522D44F  
.baidu.com       TRUE   / FALSE                 H_PS_PSSID  19638_1453_17710_18240_21091_18560_17001_  
                                                            21191_21161  
.baidu.com       TRUE   / FALSE   3622386254    PSTM        1474902606  
www.baidu.com    FALSE  / FALSE                 BDSVRTM     0  
www.baidu.com    FALSE  / FALSE                 BD_HOME     0
</code></pre></div>
<p>另外，LWPCookieJar 同样可以读取和保存 Cookies，但是保存的格式和 MozillaCookieJar 不一样，它会保存成 libwww-perl(LWP) 格式的 Cookies 文件。</p>
<p>要保存成 LWP 格式的 Cookies 文件，可以在声明时就改为：</p>
<div class="highlight"><pre><span></span><code><span class="n">cookie</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">cookiejar</span><span class="o">.</span><span class="n">LWPCookieJar</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div>
<p>此时生成的内容如下：</p>
<div class="highlight"><pre><span></span><code>#LWP-Cookies-2.0  
Set-Cookie3: BAIDUID=&quot;0CE9C56F598E69DB375B7C294AE5C591:FG=1&quot;; path=&quot;/&quot;; domain=&quot;.baidu.com&quot;; path_spec;   
    domain_dot; expires=&quot;2084-10-14 18:25:19Z&quot;; version=0  
Set-Cookie3: BIDUPSID=0CE9C56F598E69DB375B7C294AE5C591; path=&quot;/&quot;; domain=&quot;.baidu.com&quot;; path_spec; domain_dot;  
    expires=&quot;2084-10-14 18:25:19Z&quot;; version=0  
Set-Cookie3: H_PS_PSSID=20048_1448_18240_17944_21089_21192_21161_20929; path=&quot;/&quot;; domain=&quot;.baidu.com&quot;;  
    path_spec; domain_dot; discard; version=0  
Set-Cookie3: PSTM=1474902671; path=&quot;/&quot;; domain=&quot;.baidu.com&quot;; path_spec; domain_dot; expires=&quot;2084-10-14  
    18:25:19Z&quot;; version=0  
Set-Cookie3: BDSVRTM=0; path=&quot;/&quot;; domain=&quot;www.baidu.com&quot;; path_spec; discard; version=0  
Set-Cookie3: BD_HOME=0; path=&quot;/&quot;; domain=&quot;www.baidu.com&quot;; path_spec; discard; version=0
</code></pre></div>
<p>由此看来，生成的格式还是有比较大差异的。</p>
<p>那么，生成了 Cookies 文件后，怎样从文件中读取并利用呢？</p>
<p>下面我们以 LWPCookieJar 格式为例来看一下：</p>
<div class="highlight"><pre><span></span><code><span class="n">cookie</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">cookiejar</span><span class="o">.</span><span class="n">LWPCookieJar</span><span class="p">()</span>  
<span class="n">cookie</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;cookies.txt&#39;</span><span class="p">,</span> <span class="n">ignore_discard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_expires</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>  
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>  
<span class="n">response</span> <span class="o">=</span> <span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</code></pre></div>
<p>可以看到，这里调用 load 方法来读取本地的 Cookies 文件，获取到了 Cookies 的内容。不过前提是我们首先生成了 LWPCookieJar 格式的 Cookies，并保存成文件，然后读取 Cookies 之后使用同样的方法构建 Handler 和 Opener 即可完成操作。</p>
<p>运行结果正常的话，会输出百度网页的源代码。</p>
<p>通过上面的方法，我们可以实现绝大多数请求功能的设置了。</p>
<p>这便是 urllib 库中 request 模块的基本用法，如果想实现更多的功能，可以参考官方文档的说明：<a href="https://docs.python.org/3/library/urllib.request.html#basehandler-objects">https://docs.python.org/3/library/urllib.request.html#basehandler-objects</a>。</p>
<h2 id="_3">处理异常</h2>
<p>urllib 的 error 模块定义了由 request 模块产生的异常。如果出现了问题，request 模块便会抛出 error 模块中定义的异常。error 模块定义了三种异常:</p>
<div class="highlight"><pre><span></span><code>[&#39;ContentTooShortError&#39;, &#39;HTTPError&#39;, &#39;URLError&#39;]
</code></pre></div>
<h3 id="urlerror">URLError</h3>
<p>URLError 类来自 urllib 库的 error 模块，它继承自<code>OSError</code>类，是 error 异常模块的基类，由 request 模块产生的异常都可以通过捕获这个类来处理。</p>
<p>它具有一个属性 reason，即返回错误的原因。</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">error</span> 
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># 请求一个不存在的网页</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://cuiqingcai.com/index.htm&#39;</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Bad Gateway
</code></pre></div>
<h3 id="httperror">HTTPError</h3>
<p>它是 <code>URLError</code>的子类，专门用来处理 HTTP 请求错误，比如认证请求失败等。它有如下 3 个属性。</p>
<ul>
<li>
<p>code：返回 HTTP 状态码，比如 404 表示网页不存在，500 表示服务器内部错误等。</p>
</li>
<li>
<p>reason：同父类一样，用于返回错误的原因。</p>
</li>
<li>
<p>headers：返回请求头。</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span><span class="n">error</span>  
<span class="k">try</span><span class="p">:</span>  
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://cuiqingcai.com/index.htm&#39;</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Not Found
404
Server: nginx/1.10.3 (Ubuntu)
Date: Sat, 13 Jun 2020 05:40:02 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: close
Set-Cookie: PHPSESSID=82bor4hv5of8dd5dbdppp8jut2; path=/
Pragma: no-cache
Vary: Cookie
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Cache-Control: no-cache, must-revalidate, max-age=0
Link: &lt;https://cuiqingcai.com/wp-json/&gt;; rel=&quot;https://api.w.org/&quot;
</code></pre></div>
<p>依然是同样的网址，这里捕获了 <code>HTTPError</code>异常，输出了 reason、code 和 headers 属性。</p>
<p>因为 <code>URLError</code>是 <code>HTTPError</code>的父类，所以可以先选择捕获子类的错误，再去捕获父类的错误，所以上述代码更好的写法如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">error</span>  

<span class="k">try</span><span class="p">:</span>  
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://cuiqingcai.com/index.htm&#39;</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>  
<span class="k">else</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Request Successfully&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Not Found
404
Server: nginx/1.10.3 (Ubuntu)
Date: Sat, 13 Jun 2020 05:40:02 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: close
Set-Cookie: PHPSESSID=ekbuprp6akme47u5dm53uecti2; path=/
Pragma: no-cache
Vary: Cookie
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Cache-Control: no-cache, must-revalidate, max-age=0
Link: &lt;https://cuiqingcai.com/wp-json/&gt;; rel=&quot;https://api.w.org/&quot;
</code></pre></div>
<p>这样就可以做到先捕获 <code>HTTPError</code>，获取它的错误状态码、原因、headers 等信息。如果不是 <code>HTTPError</code>异常，就会捕获 <code>URLError</code>异常，输出错误原因。最后，用 else 来处理正常的逻辑。这是一个较好的异常处理写法。</p>
<p>有时候，reason 属性返回的不一定是字符串，也可能是一个对象。再看下面的实例：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>  
<span class="kn">import</span> <span class="nn">urllib.request</span>  
<span class="kn">import</span> <span class="nn">urllib.error</span>  

<span class="k">try</span><span class="p">:</span>  
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://www.baidu.com&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>  
<span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>  
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">):</span>  
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TIME OUT&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;class &#39;socket.timeout&#39;&gt;
TIME OUT
</code></pre></div>
<p>这里我们直接设置超时时间来强制抛出 timeout 异常。</p>
<p>可以发现，reason 属性的结果是 <code>socket.timeout</code> 类。所以，这里我们可以用 <code>isinstance</code>方法来判断它的类型，作出更详细的异常判断。</p>
<h2 id="_4">解析链接</h2>
<p>urllib 库的 parse 模块，它定义了处理 URL 的标准接口，例如实现 URL 各部分的抽取、合并以及链接转换。它支持如下协议的 URL 处理：file、ftp、gopher、hdl、http、https、imap、mailto、 mms、news、nntp、prospero、rsync、rtsp、rtspu、sftp、 sip、sips、snews、svn、svn+ssh、telnet 和 wais。</p>
<h3 id="urlparse">urlparse</h3>
<p>该方法可以实现 URL 的识别和分段：      <br />
<div class="highlight"><pre><span></span><code><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">urlstring</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></p>
<ul>
<li>
<p><code>urlstring</code>：待解析的 URL</p>
</li>
<li>
<p><code>scheme</code>：它是默认的协议（比如 http 或 https 等）。
scheme 参数只有在 urlstring 中不包含 scheme 信息时才生效。</p>
</li>
<li>
<p><code>allow_fragments</code>：是否忽略 fragment。
如果设置为 False，fragment 部分就会被忽略，它会被解析为 path、parameters 或者 query 的一部分，而 fragment 部分为空。当 URL 中不包含 params 和 query 时，fragment 便会被解析为 path 的一部分</p>
</li>
</ul>
<p>例子：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>  

<span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com/index.html;user?id=5#comment&#39;</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;class &#39;urllib.parse.ParseResult&#39;&gt; ParseResult(scheme=&#39;http&#39;,
netloc=&#39;www.baidu.com&#39;, path=&#39;/index.html&#39;, params=&#39;user&#39;,
query=&#39;id=5&#39;, fragment=&#39;comment&#39;)
</code></pre></div>
<p>可以看到，返回结果是一个 <code>ParseResult</code>类型的对象，它包含 6 个部分，分别是 scheme、netloc、path、params、query 和 fragment。</p>
<p>观察一下该实例的 URL：</p>
<div class="highlight"><pre><span></span><code>http://www.baidu.com/index.html;user?id=5#comment
</code></pre></div>
<p>可以发现，urlparse 方法将其拆分成了 6 个部分。大体观察可以发现，解析时有特定的分隔符。比如，:// 前面的就是 scheme，代表协议；第一个 / 符号前面便是 netloc，即域名，后面是 path，即访问路径；分号；后面是 params，代表参数；问号？后面是查询条件 query，一般用作 GET 类型的 URL；井号 #后面是锚点，用于直接定位页面内部的下拉位置。</p>
<p>所以，可以得出一个标准的链接格式，具体如下：</p>
<div class="highlight"><pre><span></span><code>scheme://netloc/path;params?query#fragment
</code></pre></div>
<p>一个标准的 URL 都会符合这个规则，利用 <code>urlparse</code>方法可以将它拆分开来。</p>
<p>返回结果 <code>ParseResult</code>实际上是一个元组，我们可以用索引顺序来获取，也可以用属性名获取。示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>  

<span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com/index.html#comment&#39;</span><span class="p">,</span> 
                  <span class="n">allow_fragments</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">netloc</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>http
http
www.baidu.com
www.baidu.com
</code></pre></div>
<h3 id="urlunparse">urlunparse</h3>
<p>有了 <code>urlparse</code>方法，相应地就有了它的对立方法 <code>urlunparse</code>。它接受的参数是一个可迭代对象，但是它的长度必须是 6，否则会抛出参数数量不足或者过多的问题。</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlunparse</span>  

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;www.baidu.com&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;a=6&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urlunparse</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>http://www.baidu.com/index.html;user?a=6#comment
</code></pre></div>
<p>这里参数 data 用了列表类型。当然，你也可以用其他类型，比如元组或者特定的数据结构。</p>
<h3 id="urlsplit">urlsplit</h3>
<p>这个方法和 <code>urlparse</code>方法非常相似，只不过它不再单独解析 <code>params</code>这一部分，只返回 5 个结果。上面例子中的 <code>params</code>会合并到 path 中。示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlsplit</span>  

<span class="n">result</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com/index.html;user?id=5#comment&#39;</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>SplitResult(scheme=&#39;http&#39;, netloc=&#39;www.baidu.com&#39;,
path=&#39;/index.html;user&#39;, query=&#39;id=5&#39;, fragment=&#39;comment&#39;)
</code></pre></div>
<p>可以发现，返回结果是 <code>SplitResult</code>，它其实也是一个元组类型，既可以用属性获取值，也可以用索引来获取。</p>
<h3 id="urlunsplit">urlunsplit</h3>
<p>与 <code>urlunparse</code>方法类似，它也是将链接各个部分组合成完整链接的方法，传入的参数也是一个可迭代对象，例如列表、元组等，唯一的区别是长度必须为 5。示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlunsplit</span>  

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="s1">&#39;www.baidu.com&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="s1">&#39;a=6&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">]</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urlunsplit</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>http://www.baidu.com/index.html?a=6#comment
</code></pre></div>
<h3 id="urljoin">urljoin</h3>
<p>有了 <code>urlunparse</code>和 <code>urlunsplit</code>方法，我们可以完成链接的合并，不过前提必须要有特定长度的对象，链接的每一部分都要清晰分开。</p>
<p>此外，生成链接还有另一个方法，那就是 <code>urljoin</code>方法。我们可以提供一个 base_url（基础链接）作为第一个参数，将新的链接作为第二个参数，该方法会分析 base_url 的 scheme、netloc 和 path 这 3 个内容并对新链接缺失的部分进行补充，最后返回结果。</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>  

<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">,</span> <span class="s1">&#39;FAQ.html&#39;</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">,</span> <span class="s1">&#39;https://cuiqingcai.com/FAQ.html&#39;</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com/about.html&#39;</span><span class="p">,</span> <span class="s1">&#39;https://cuiqingcai.com/FAQ.html&#39;</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com/about.html&#39;</span><span class="p">,</span> <span class="s1">&#39;https://cuiqingcai.com/FAQ.html?question=2&#39;</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com?wd=abc&#39;</span><span class="p">,</span> <span class="s1">&#39;https://cuiqingcai.com/index.php&#39;</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">,</span> <span class="s1">&#39;?category=2#comment&#39;</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;www.baidu.com&#39;</span><span class="p">,</span> <span class="s1">&#39;?category=2#comment&#39;</span><span class="p">))</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">urljoin</span><span class="p">(</span><span class="s1">&#39;www.baidu.com#comment&#39;</span><span class="p">,</span> <span class="s1">&#39;?category=2&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>http://www.baidu.com/FAQ.html
https://cuiqingcai.com/FAQ.html
https://cuiqingcai.com/FAQ.html
https://cuiqingcai.com/FAQ.html?question=2
https://cuiqingcai.com/index.php
http://www.baidu.com?category=2#comment
www.baidu.com?category=2#comment
www.baidu.com?category=2
</code></pre></div>
<p>可以发现，base_url 提供了三项内容 scheme、netloc 和 path。如果这 3 项在新的链接里不存在，就予以补充；如果新的链接存在，就使用新的链接的部分。而 base_url 中的 params、query 和 fragment 是不起作用的。</p>
<h3 id="urlencode">urlencode</h3>
<p><code>urlencode</code>在构造 GET 请求参数的时候非常有用，示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>  

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>  
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;germey&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">22</span>  
<span class="p">}</span>  
<span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;http://www.baidu.com?&#39;</span>  
<span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>http://www.baidu.com?name=germey&amp;age=22
</code></pre></div>
<p>这里首先声明了一个字典来将参数表示出来，然后调用 urlencode 方法将其序列化为 GET 请求参数。</p>
<p>这个方法非常常用。有时为了更加方便地构造参数，我们会事先用字典来表示。要转化为 URL 的参数时，只需要调用该方法即可。</p>
<h3 id="parse_qs">parse_qs</h3>
<p>有了序列化，必然就有反序列化。如果我们有一串 GET 请求参数，利用 <code>parse_qs</code>方法，就可以将它转回字典，示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">parse_qs</span>  

<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;name=germey&amp;amp;age=22&#39;</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">parse_qs</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>{&#39;name&#39;: [&#39;germey&#39;], &#39;age&#39;: [&#39;22&#39;]}
</code></pre></div>
<p>可以看到，这样就成功转回为字典类型了。</p>
<h3 id="parse_qsl">parse_qsl</h3>
<p>还有一个 <code>parse_qsl</code>方法，它用于将参数转化为元组组成的列表，示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">parse_qsl</span>  

<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;name=germey&amp;amp;age=22&#39;</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">parse_qsl</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[(&#39;name&#39;, &#39;germey&#39;), (&#39;age&#39;, &#39;22&#39;)]
</code></pre></div>
<p>可以看到，运行结果是一个列表，而列表中的每一个元素都是一个元组，元组的第一个内容是参数名，第二个内容是参数值。</p>
<h3 id="quote">quote</h3>
<p>该方法可以将内容转化为 URL 编码的格式。URL 中带有中文参数时，有时可能会导致乱码的问题，此时用这个方法可以将中文字符转化为 URL 编码，示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>  

<span class="n">keyword</span> <span class="o">=</span> <span class="s1">&#39; 壁纸 &#39;</span>  
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.baidu.com/s?wd=&#39;</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>https://www.baidu.com/s?wd=%20%E5%A3%81%E7%BA%B8%20
</code></pre></div>
<h3 id="unquote">unquote</h3>
<p>有了 quote 方法，当然还有 unquote 方法，它可以进行 URL 解码，示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">unquote</span>  

<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.baidu.com/s?wd=</span><span class="si">% E</span><span class="s1">5% A3</span><span class="si">%81%</span><span class="s1"> E7% BA% B8&#39;</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">unquote</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>https://www.baidu.com/s?wd=% E5% A3�% E7% BA% B8
</code></pre></div>
<p>这是上面得到的 URL 编码后的结果，再利用 unquote 方法还原。</p>
<h2 id="robots">分析 Robots 协议</h2>
<p>利用 urllib 的 robotparser 模块，我们可以实现网站 Robots 协议的分析。</p>
<h3 id="robots_1">Robots 协议</h3>
<p>Robots 协议也称作爬虫协议、机器人协议，它的全名叫作网络爬虫排除标准（Robots Exclusion Protocol），用来告诉爬虫和搜索引擎哪些页面可以抓取，哪些不可以抓取。它通常是一个叫作 robots.txt 的文本文件，一般放在网站的根目录下。</p>
<p>当搜索爬虫访问一个站点时，它首先会检查这个站点根目录下是否存在 robots.txt 文件，如果存在，搜索爬虫会根据其中定义的爬取范围来爬取。如果没有找到这个文件，搜索爬虫便会访问所有可直接访问的页面。</p>
<p>下面是一个 robots.txt 的样例：</p>
<div class="highlight"><pre><span></span><code>User-agent: *  
Disallow: /  
Allow: /public/
</code></pre></div>
<p>这实现了对所有搜索爬虫只允许爬取 public 目录的功能，将上述内容保存成 robots.txt 文件，放在网站的根目录下，和网站的入口文件（比如 index.php、index.html 和 index.jsp 等）放在一起。</p>
<p>上面的 User-agent 描述了搜索爬虫的名称，这里将其设置为 * 则代表该协议对任何爬取爬虫有效。比如，我们可以设置：</p>
<div class="highlight"><pre><span></span><code>User-agent: Baiduspider
</code></pre></div>
<p>这就代表我们设置的规则对百度爬虫是有效的。如果有多条 User-agent 记录，则就会有多个爬虫会受到爬取限制，但至少需要指定一条。</p>
<p>Disallow 指定了不允许抓取的目录，比如上例子中设置为 / 则代表不允许抓取所有页面。</p>
<p>Allow 一般和 Disallow 一起使用，一般不会单独使用，用来排除某些限制。现在我们设置为 /public/，则表示所有页面不允许抓取，但可以抓取 public 目录。</p>
<p>下面我们再来看几个例子。禁止所有爬虫访问任何目录的代码如下：</p>
<div class="highlight"><pre><span></span><code>User-agent: *   
Disallow: /
</code></pre></div>
<p>允许所有爬虫访问任何目录的代码如下：</p>
<div class="highlight"><pre><span></span><code>User-agent: *  
Disallow:
</code></pre></div>
<p>另外，直接把 robots.txt 文件留空也是可以的。</p>
<p>禁止所有爬虫访问网站某些目录的代码如下：</p>
<div class="highlight"><pre><span></span><code>User-agent: *  
Disallow: /private/  
Disallow: /tmp/
</code></pre></div>
<p>只允许某一个爬虫访问的代码如下：</p>
<div class="highlight"><pre><span></span><code>User-agent: WebCrawler  
Disallow:  
User-agent: *  
Disallow: /
</code></pre></div>
<p>这些是 robots.txt 的一些常见写法。</p>
<h3 id="_5">爬虫名称</h3>
<p>大家可能会疑惑，爬虫名是哪儿来的？为什么就叫这个名？其实它是有固定名字的了，比如百度的就叫作 BaiduSpider。下表列出了一些常见的搜索爬虫的名称及对应的网站。</p>
<table>
<thead>
<tr>
<th>爬虫名称</th>
<th>名　　称</th>
<th>网　　站</th>
</tr>
</thead>
<tbody>
<tr>
<td>BaiduSpider</td>
<td>百度</td>
<td>www.baidu.com</td>
</tr>
<tr>
<td>Googlebot</td>
<td>谷歌</td>
<td>www.google.com</td>
</tr>
<tr>
<td>360Spider</td>
<td>360 搜索</td>
<td>www.so.com</td>
</tr>
<tr>
<td>YodaoBot</td>
<td>有道</td>
<td>www.youdao.com</td>
</tr>
<tr>
<td>ia_archiver</td>
<td>Alexa</td>
<td>www.alexa.cn</td>
</tr>
<tr>
<td>Scooter</td>
<td>altavista</td>
<td>www.altavista.com</td>
</tr>
</tbody>
</table>
<h3 id="robotparser">robotparser</h3>
<p>了解 Robots 协议之后，我们就可以使用 robotparser 模块来解析 robots.txt 了。该模块提供了一个类 <code>RobotFileParser</code>，它可以根据某网站的 robots.txt 文件来判断一个爬取爬虫是否有权限来爬取这个网页。</p>
<p>该类用起来非常简单，只需要在构造方法里传入 robots.txt 的链接即可。首先看一下它的声明：</p>
<div class="highlight"><pre><span></span><code><span class="n">urllib</span><span class="o">.</span><span class="n">robotparser</span><span class="o">.</span><span class="n">RobotFileParser</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>&lt;urllib.robotparser.RobotFileParser at 0x1dbbcc44d30&gt;
</code></pre></div>
<p>当然，也可以在声明时不传入，默认为空，最后再使用 <code>set_url()</code>方法设置一下也可。</p>
<p>下面列出了这个类常用的几个方法。</p>
<ul>
<li>
<p><code>set_url</code>：用来设置 robots.txt 文件的链接。如果在创建 <code>RobotFileParser</code>对象时传入了链接，那么就不需要再使用这个方法设置了。</p>
</li>
<li>
<p><code>read</code>：读取 robots.txt 文件并进行分析。注意，这个方法执行一个读取和分析操作，如果不调用这个方法，接下来的判断都会为 False，所以一定记得调用这个方法。这个方法不会返回任何内容，但是执行了读取操作。</p>
</li>
<li>
<p><code>parse</code>：用来解析 robots.txt 文件，传入的参数是 robots.txt 某些行的内容，它会按照 robots.txt 的语法规则来分析这些内容。</p>
</li>
<li>
<p><code>can_fetch</code>：该方法传入两个参数，第一个是 User-agent，第二个是要抓取的 URL。返回的内容是该搜索引擎是否可以抓取这个 URL，返回结果是 True 或 False。</p>
</li>
<li>
<p><code>mtime</code>：返回的是上次抓取和分析 robots.txt 的时间，这对于长时间分析和抓取的搜索爬虫是很有必要的，你可能需要定期检查来抓取最新的 robots.txt。</p>
</li>
<li>
<p><code>modified</code>：它同样对长时间分析和抓取的搜索爬虫很有帮助，将当前时间设置为上次抓取和分析 robots.txt 的时间。</p>
</li>
</ul>
<p>这里以简书为例，首先创建 <code>RobotFileParser</code>对象，然后通过 <code>set_url</code> 方法设置了 robots.txt 的链接：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># need to fix</span>
<span class="kn">from</span> <span class="nn">urllib.robotparser</span> <span class="kn">import</span> <span class="n">RobotFileParser</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">RobotFileParser</span><span class="p">()</span>
<span class="n">rp</span><span class="o">.</span><span class="n">set_url</span><span class="p">(</span><span class="s1">&#39;http://www.jianshu.com/robots.txt&#39;</span><span class="p">)</span>
<span class="n">rp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">can_fetch</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.jianshu.com/p/b67554025d7d&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">can_fetch</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s2">&quot;http://www.jianshu.com/search?q=python&amp;page=1&amp;type=collections&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>False
False
</code></pre></div>
<p>当然，不用这个方法的话，可以在声明时直接用如下方法设置：</p>
<div class="highlight"><pre><span></span><code><span class="n">rp</span> <span class="o">=</span> <span class="n">RobotFileParser</span><span class="p">(</span><span class="s1">&#39;http://www.jianshu.com/robots.txt&#39;</span><span class="p">)</span>
</code></pre></div>
<p>接着利用 can_fetch 方法判断了网页是否可以被抓取。</p>
<p>这里同样可以使用 parse 方法执行读取和分析，示例如下：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># need to fix</span>
<span class="kn">from</span> <span class="nn">urllib.robotparser</span> <span class="kn">import</span> <span class="n">RobotFileParser</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">RobotFileParser</span><span class="p">()</span>
<span class="n">rp</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;http://www.jianshu.com/robots.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">can_fetch</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.jianshu.com/p/b67554025d7d&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">can_fetch</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s2">&quot;http://www.jianshu.com/search?q=python&amp;page=1&amp;type=collections&quot;</span><span class="p">))</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="6.5.calendar.html" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              6.5.calendar
            </div>
          </div>
        </a>
      
      
        <a href="6.8.requests.html" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              6.8.requests
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.34eae1b6.min.js"></script>
      
        <script src="../javascript/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>